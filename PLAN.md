# PLAN.md  
## Поэтапный план реализации приложения eGoNext — Дневник туриста  
---

План составлен на основании требований из PROJECT.md. Этапы идут в порядке зависимостей: от инфраструктуры к экранам и функциям.

---

## Этап 1. Инфраструктура и база данных

1. **Подключить SQLite**  
   - Установить и настроить пакет для работы с SQLite в Expo (например, `expo-sqlite`).  
   - Создать модуль инициализации БД при старте приложения.

2. **Спроектировать и создать схему БД**  
   - Таблица **places**: id, name, description, visitlater, liked, latitude, longitude (dd), createdAt.  
   - Таблица **place_photos**: id, placeId, uri/path, порядок.  
   - Таблица **trips**: id, title, description, startDate, endDate, createdAt, current.  
   - Таблица **trip_places**: id, tripId, placeId, order, visited, visitDate, notes; связь с places.  
   - Таблица **trip_place_photos**: id, tripPlaceId, uri/path, порядок.  
   - Обеспечить целостность: внешние ключи, индексы при необходимости.

3. **Определить типы и модели данных (TypeScript)**  
   - Интерфейсы/типы: Place, PlacePhoto, Trip, TripPlace, TripPlacePhoto.  
   - Соответствие полей схеме БД и сущностям из PROJECT.md.

---

## Этап 2. Слой работы с данными

4. **Реализовать доступ к данным**  
   - Функции/репозитории для CRUD по **places** (добавление, список, обновление, удаление, получение по id).  
   - Функции для **place_photos** (добавить/удалить фото к месту).  
   - Функции для **trips** (CRUD, пометка текущей поездки `current`).  
   - Функции для **trip_places** (добавить/удалить место в поездке, изменить порядок, обновить visited, visitDate, notes).  
   - Функции для **trip_place_photos**.

5. **Хранение файлов фотографий**  
   - Определить каталог для фото (документы приложения / FileSystem).  
   - Сохранять пути/URI в БД; при удалении места/поездки — удалять файлы.

---

## Этап 3. Навигация и главный экран

6. **Настроить структуру маршрутов Expo Router**  
   - Корневой layout (например, Stack или Tabs по выбору).  
   - Маршруты: главный экран, места, поездки, следующее место, настройки.  
   - Соответствие структуры папок `app/` описанной навигации.

7. **Реализовать главный экран (Home)**  
   - AppBar с названием «eGoNext».  
   - Вертикальный список кнопок (React Native Paper): Места, Поездки, Следующее место, Настройки.  
   - Переход по нажатию на соответствующий экран.

---

## Этап 4. Режим «Места»

8. **Экран «Список мест»**  
   - Загрузка списка мест из БД.  
   - Отображение в списке (List, Card или аналог из Paper): название, краткое описание/координаты.  
   - Кнопка «Добавить место».  
   - Переход к детальной карточке места по тапу.

9. **Экран «Детальная карточка места»**  
   - Показать все поля места: название, описание, visitlater, liked, координаты.  
   - Показать прикреплённые фотографии.  
   - Действия: открыть на карте, добавить/удалить фото, редактировать, удалить место.

10. **Экран «Добавить/редактировать место»**  
    - Форма: название, описание, visitlater, liked, координаты (ввод или выбор на карте при возможности).  
    - Прикрепление фотографий (камера/галерея).  
    - Сохранение в БД и обновление списка/карточки.

---

## Этап 5. Режим «Поездки»

11. **Экран «Список поездок»**  
    - Загрузка поездок из БД.  
    - Отображение: название, даты, признак текущей поездки.  
    - Кнопка «Создать поездку».  
    - Переход к деталям поездки по тапу.

12. **Экран «Создать поездку»**  
    - Форма: title, description, startDate, endDate.  
    - Сохранение поездки в БД, переход к редактированию маршрута (добавление мест).

13. **Экран «Детали поездки» (маршрут)**  
    - Показать заголовок, даты, описание.  
    - Упорядоченный список мест поездки (TripPlace): название, порядок, visited, visitDate, notes.  
    - Возможности: добавить места (из списка мест или создать новые), изменить порядок (drag-and-drop или кнопки вверх/вниз), отметить посещённым, задать visitDate и notes.  
    - Просмотр как плана и как дневника (по факту посещений и заметок).

14. **Добавление мест в поездку**  
    - Экран/модалка выбора из существующих мест (список мест).  
    - Опционально: создание нового места «на лету» и добавление в поездку.  
    - Сохранение в trip_places с полем order.

15. **Фото и заметки в поездке**  
    - В карточке места внутри поездки: поле notes, список фото (trip_place_photos).  
    - Добавление/удаление фото и редактирование заметок с сохранением в БД.

---

## Этап 6. Режим «Следующее место»

16. **Экран «Следующее место»**  
    - Определить активную поездку (current = true).  
    - Найти первое место в trip_places с visited = false (по order).  
    - Показать информацию об этом месте (название, описание, координаты).  
    - Если активной поездки нет или все места посещены — показать сообщение (например, «Нет следующего места»).

17. **Интеграция с картой и навигатором**  
    - Кнопка «Открыть на карте»: открыть координаты в системном/встроенном картном приложении (linking).  
    - Кнопка «Маршрут»: открыть в навигаторе (Google Maps / Apple Maps через URL-схему).

---

## Этап 7. Карты и геолокация (по необходимости для MVP)

18. **Отображение места на карте**  
    - Использовать экспо-модуль карт или linking на системное приложение.  
    - Передавать координаты (dd) из Place/TripPlace.

19. **Получение координат**  
    - При создании/редактировании места: опционально подставлять текущую геолокацию (expo-location) или ввод вручную.

---

## Этап 8. Настройки и доводка

20. **Экран «Настройки»**  
    - Минимальный набор: о приложении, версия.  
    - При необходимости: тема (светлая/тёмная), единицы, язык — по объёму MVP.

21. **Офлайн и стабильность**  
    - Убедиться, что все операции работают без сети.  
    - Обработка ошибок БД и прав доступа к файлам/камере.

22. **Финальная проверка**  
    - Проход по сценариям: добавление мест → создание поездки → добавление мест в поездку → следующее место → отметка посещения и заметки.  
    - Проверка на Android и iOS (или хотя бы одной платформе по условиям).

---

## Порядок выполнения (кратко)

| №  | Этап                         | Ключевые задачи                                      |
|----|------------------------------|------------------------------------------------------|
| 1  | Инфраструктура и БД          | SQLite, схема таблиц, TypeScript-модели             |
| 2  | Слой данных                 | Репозитории/функции для places, trips, фото         |
| 3  | Навигация и главный экран   | Expo Router, главный экран с кнопками                |
| 4  | Режим «Места»               | Список, карточка, добавление/редактирование, фото     |
| 5  | Режим «Поездки»             | Список, создание, маршрут, порядок, посещения, заметки |
| 6  | Режим «Следующее место»     | Расчёт следующего места, карта/навигатор             |
| 7  | Карты и геолокация          | Карта, координаты, ссылки на навигатор               |
| 8  | Настройки и доводка         | Настройки, офлайн, тестирование                      |

---

## Этап 8 — Выполнено

- **20. Экран «Настройки»** — Реализован: блок «О приложении» (название, версия из app.json), краткое описание, переключатель тёмной темы (MD3).
- **21. Офлайн и стабильность** — Обработка ошибок добавлена во всех ключевых экранах (try/catch + Alert). Сообщения при отказе в доступе к галерее и геолокации.
- **22. Финальная проверка** — Чеклист сценариев см. ниже.

### Чеклист сценариев

1. **Места** — Добавить место (с фото, геолокацией) → открыть детали → редактировать → удалить фото → удалить место.
2. **Поездки** — Создать поездку → добавить места из списка → изменить порядок ↑/↓ → отметить посещённым → открыть место в поездке → заметки и фото.
3. **Следующее место** — Установить поездку текущей → открыть «Следующее место» → «Открыть на карте» / «Маршрут».
4. **Настройки** — Переключить тему, проверить версию и текст «О приложении».
5. **Офлайн** — Выключить сеть и проверить работу всех операций.

---

После выполнения плана приложение будет соответствовать MVP из PROJECT.md: офлайн-дневник туриста с местами, поездками и экраном «Следующее место».
